<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SEQKoalaDataPipeline">
<title>linear-referencing-03 • SEQKoalaDataPipeline</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="linear-referencing-03">
<meta property="og:description" content="SEQKoalaDataPipeline">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SEQKoalaDataPipeline</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/index.html">introduction</a>
    <a class="dropdown-item" href="../articles/v01-setup.html">setup</a>
    <a class="dropdown-item" href="../articles/v02-get-data.html">get-data-02</a>
    <a class="dropdown-item" href="../articles/v03-linear-referencing.html">linear-referencing-03</a>
    <a class="dropdown-item" href="../articles/v04-covariates.html">v04-covariates</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>linear-referencing-03</h1>
            
      
      
      <div class="d-none name"><code>v03-linear-referencing.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://seq-koala-monitoring.github.io/data-pipeline/">SEQKoalaDataPipeline</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="linear-referencing-dynamic-segmentation">Linear referencing / dynamic segmentation<a class="anchor" aria-label="anchor" href="#linear-referencing-dynamic-segmentation"></a>
</h2>
<p>The linear referencing/ dynamic segmentation approach is used to
relate the line transects with the grid information and covariate
layers. While it can be used to derive outputs for the statistical
model, the tables generated by linear referencing itself could serve
other purposes.</p>
<p>The toolbox for linear referencing in this package allows the user to
generate a “Route Event Layer” (also referred to as “Route Event Tables”
or “Route Table”) that are the fundamental way which routes (i.e.
Transects) are represented in linear referencing.</p>
<p>In the linear referencing terminology, each transect is represented
as a “route”. Each record in the “Route Event Layer” that stores the
distance from the start of a transect of where an “Event” occurred. An
event can be an intersection with a grid cell, or certain values within
the covariate layer. Using the <code>fcn_route_table</code> call, we can
create a “Route Event Layer” that records each “Event” and has a
TransectID that relates each event back to the transect concerned.</p>
<p>The function call creates a few new columns that records the
attributes of the event:</p>
<ol style="list-style-type: decimal">
<li>FMEAS: the “From Measure”, which is the distance from the start
point of the transect where the event starts</li>
<li>TMEAS: the “To Measure”, which is the distance from the start point
of the transect where the event ends</li>
<li>Variable Name (e.g. GridID): the value of the event, in this case,
the GridID of the grid cell this “Event” is describing</li>
<li>Tlength: transect length</li>
<li>lpercent: the percentage (proportion) of the transect that is
covered by this event</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="st">"M:\\Users\\uqfcho\\Documents\\seq-koala-monitoring\\working_data"</span></span>
<span><span class="fu"><a href="../reference/fcn_set_home_dir.html">fcn_set_home_dir</a></span><span class="op">(</span><span class="va">data_dir</span><span class="op">)</span></span>
<span><span class="va">table_sf_2020</span> <span class="op">&lt;-</span> <span class="fu">fcn_line_transect_sf_2020</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/fcn_set_grid_size.html">fcn_set_grid_size</a></span><span class="op">(</span><span class="fl">5000</span><span class="op">)</span> <span class="co"># grid width/ height in meters, and generate grid in local environment</span></span>
<span><span class="co">#&gt; Simple feature collection with 1800 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 378280 ymin: 6862464 xmax: 558280 ymax: 7112464</span></span>
<span><span class="co">#&gt; Projected CRS: GDA2020 / MGA zone 56</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;                          geometry  GridID</span></span>
<span><span class="co">#&gt; 1  POLYGON ((378280 6862464, 3...  5000_1</span></span>
<span><span class="co">#&gt; 2  POLYGON ((383280 6862464, 3...  5000_2</span></span>
<span><span class="co">#&gt; 3  POLYGON ((388280 6862464, 3...  5000_3</span></span>
<span><span class="co">#&gt; 4  POLYGON ((393280 6862464, 3...  5000_4</span></span>
<span><span class="co">#&gt; 5  POLYGON ((398280 6862464, 4...  5000_5</span></span>
<span><span class="co">#&gt; 6  POLYGON ((403280 6862464, 4...  5000_6</span></span>
<span><span class="co">#&gt; 7  POLYGON ((408280 6862464, 4...  5000_7</span></span>
<span><span class="co">#&gt; 8  POLYGON ((413280 6862464, 4...  5000_8</span></span>
<span><span class="co">#&gt; 9  POLYGON ((418280 6862464, 4...  5000_9</span></span>
<span><span class="co">#&gt; 10 POLYGON ((423280 6862464, 4... 5000_10</span></span>
<span><span class="va">fishnet</span> <span class="op">&lt;-</span> <span class="fu">fcn_get_grid</span><span class="op">(</span><span class="op">)</span> <span class="co"># Retrieve grid from environment for plotting</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">441430</span>, <span class="fl">449400</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6928706</span>, <span class="fl">6936814</span><span class="op">)</span>, expand <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">route_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fcn_route_table.html">fcn_route_table</a></span><span class="op">(</span><span class="va">fishnet</span>, <span class="va">table_sf_2020</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: attribute variables are assumed to be spatially constant</span></span>
<span><span class="co">#&gt; throughout all geometries</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">route_table</span><span class="op">[</span><span class="va">route_table</span><span class="op">$</span><span class="va">lpercent</span> <span class="op">&lt;</span> <span class="fl">0.5</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'TransectID'</span>, <span class="st">'GridID'</span>, <span class="st">'FMEAS'</span>, <span class="st">'TMEAS'</span>, <span class="st">"Tlength"</span>, <span class="st">"lpercent"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     TransectID   GridID    FMEAS     TMEAS   Tlength</span></span>
<span><span class="co">#&gt; 2059   1000.0_7.2_SOL.20200330 5000_451 327.9339 602.86400 602.86400</span></span>
<span><span class="co">#&gt; 2140.1  1004.0_30_SOL.20200716  5000_92   0.0000  52.40427 807.06010</span></span>
<span><span class="co">#&gt; 2178.1  1008.0_10_SOL.20220713 5000_350   0.0000  40.18318 350.37409</span></span>
<span><span class="co">#&gt; 2180     1009.0_1_SOL.20220720 5000_201 104.9016 198.07069 198.07069</span></span>
<span><span class="co">#&gt; 2182     1009.0_5_SOL.20220720 5000_201   0.0000  18.96872  55.44367</span></span>
<span><span class="co">#&gt; 2198     1015.0_1_SOL.20220721 5000_277 722.4784 863.04113 863.04114</span></span>
<span><span class="co">#&gt;         lpercent</span></span>
<span><span class="co">#&gt; 2059   0.4560401</span></span>
<span><span class="co">#&gt; 2140.1 0.0649323</span></span>
<span><span class="co">#&gt; 2178.1 0.1146865</span></span>
<span><span class="co">#&gt; 2180   0.4703833</span></span>
<span><span class="co">#&gt; 2182   0.3421260</span></span>
<span><span class="co">#&gt; 2198   0.1628692</span></span></code></pre></div>
<p>The results of the event route layer can be viewed by using
<code>fcn_locate_feature_from_route</code> which segments the line
transects based on the route event layer. This operation segments the
line transects many different small segments - it could be slow if the
route event layer is large, especially if applied to high-resolution
grid cells or route event layers of rasterized covariate layers
(described below). In many cases, the route event layer table itself is
a sufficient spatial representation of the linear referencing results,
but only by doing this step can we inspect the results visually.</p>
<p>Here, we see that the line transects are successfully segmented at
the border of the grid cells, as colored by different ID numbers of the
Grid where transects are colored by the last digit of the GridID:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">route_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fcn_locate_feature_from_route.html">fcn_locate_feature_from_route</a></span><span class="op">(</span><span class="va">route_table</span>, <span class="va">table_sf_2020</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fishnet</span>, color <span class="op">=</span> <span class="st">'gray50'</span>, fill <span class="op">=</span> <span class="st">'gray80'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">route_features</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">GridID</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">GridID</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">GridID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">coord_sf</span>, <span class="va">bbox</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set3"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#guides(color = 'none')+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" width="100%"><p class="caption">
plot of chunk unnamed-chunk-4
</p>
</div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Frankie Cho, Jonathan Rhodes.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
