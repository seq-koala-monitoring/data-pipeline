<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SEQKoalaDataPipeline">
<title>4. Covariate extraction • SEQKoalaDataPipeline</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="4. Covariate extraction">
<meta property="og:description" content="SEQKoalaDataPipeline">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SEQKoalaDataPipeline</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/index.html">Introduction</a>
    <a class="dropdown-item" href="../articles/v01-setup.html">1. Setup</a>
    <a class="dropdown-item" href="../articles/v02-get-data.html">2. Get Data</a>
    <a class="dropdown-item" href="../articles/v03-linear-referencing.html">3. Linear Referencing</a>
    <a class="dropdown-item" href="../articles/v04-covariates.html">4. Covariate extraction</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>4. Covariate extraction</h1>
            
      
      
      <div class="d-none name"><code>v04-covariates.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://seq-koala-monitoring.github.io/data-pipeline/">SEQKoalaDataPipeline</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dieghernan.github.io/tidyterra/" class="external-link">tidyterra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
<p>Get data</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="st">"M:\\Users\\uqfcho\\Documents\\seq-koala-monitoring\\working_data"</span></span>
<span><span class="fu"><a href="../reference/fcn_set_home_dir.html">fcn_set_home_dir</a></span><span class="op">(</span><span class="va">data_dir</span><span class="op">)</span></span>
<span><span class="va">table_sf_2020</span> <span class="op">&lt;-</span> <span class="fu">fcn_line_transect_sf_2020</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/fcn_set_grid_size.html">fcn_set_grid_size</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span> <span class="co"># grid width/ height in meters, and generate grid in local environment</span></span>
<span><span class="co">#&gt; Simple feature collection with 43472 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 378280 ymin: 6862464 xmax: 554280 ymax: 7109464</span></span>
<span><span class="co">#&gt; Projected CRS: GDA2020 / MGA zone 56</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;                          geometry  GridID</span></span>
<span><span class="co">#&gt; 1  POLYGON ((378280 6862464, 3...  1000_1</span></span>
<span><span class="co">#&gt; 2  POLYGON ((379280 6862464, 3...  1000_2</span></span>
<span><span class="co">#&gt; 3  POLYGON ((380280 6862464, 3...  1000_3</span></span>
<span><span class="co">#&gt; 4  POLYGON ((381280 6862464, 3...  1000_4</span></span>
<span><span class="co">#&gt; 5  POLYGON ((382280 6862464, 3...  1000_5</span></span>
<span><span class="co">#&gt; 6  POLYGON ((383280 6862464, 3...  1000_6</span></span>
<span><span class="co">#&gt; 7  POLYGON ((384280 6862464, 3...  1000_7</span></span>
<span><span class="co">#&gt; 8  POLYGON ((385280 6862464, 3...  1000_8</span></span>
<span><span class="co">#&gt; 9  POLYGON ((386280 6862464, 3...  1000_9</span></span>
<span><span class="co">#&gt; 10 POLYGON ((387280 6862464, 3... 1000_10</span></span>
<span><span class="va">fishnet</span> <span class="op">&lt;-</span> <span class="fu">fcn_get_grid</span><span class="op">(</span><span class="op">)</span> <span class="co"># Retrieve grid from environment for plotting</span></span></code></pre></div>
<div class="section level2">
<h2 id="covariate-extraction">Covariate extraction<a class="anchor" aria-label="anchor" href="#covariate-extraction"></a>
</h2>
<div class="section level3">
<h3 id="atemporal-rasters-covariate-extraction">Atemporal rasters covariate extraction<a class="anchor" aria-label="anchor" href="#atemporal-rasters-covariate-extraction"></a>
</h3>
<p>Likewise, the capabilities of linear referencing can be applied to
extract covariate information from Raster files. The raster layer can be
loaded using <code>fcn_covariate_raster_load</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fcn_covariate_raster_load.html">fcn_covariate_raster_load</a></span><span class="op">(</span><span class="st">"htele"</span><span class="op">)</span></span>
<span><span class="va">cov_route_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fcn_route_table_raster.html">fcn_route_table_raster</a></span><span class="op">(</span><span class="va">cov</span>, <span class="va">table_sf_2020</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cov</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="fig-unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" width="100%"><p class="caption">
plot of chunk unnamed-chunk-3
</p>
</div>
<p>The results of the linear referencing (route event layer) can be
inspected by using the same approach as above. Creation of the segments
could take a while. As seen in the outputs, the values of the event
layer (red) closely match that of the underlying raster layer (in
blue).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cov_route_table</span><span class="op">)</span></span>
<span><span class="co">#&gt;           TransectID       Date  Tlength    htele     FMEAS    TMEAS</span></span>
<span><span class="co">#&gt; 1 1.0_0_SOL.20210810 2021-08-10 484.1095 98.12856  39.51914 128.4372</span></span>
<span><span class="co">#&gt; 2 1.0_0_SOL.20210810 2021-08-10 484.1095 90.80862 128.43721 167.9564</span></span>
<span><span class="co">#&gt; 3 1.0_0_SOL.20210810 2021-08-10 484.1095 93.57124 167.95635 276.6340</span></span>
<span><span class="co">#&gt; 4 1.0_0_SOL.20210810 2021-08-10 484.1095 87.75922 276.63400 296.3936</span></span>
<span><span class="co">#&gt; 5 1.0_0_SOL.20210810 2021-08-10 484.1095 90.65904 296.39357 434.7106</span></span>
<span><span class="co">#&gt; 6 1.0_0_SOL.20210810 2021-08-10 484.1095 99.36454 434.71056 484.1095</span></span>
<span><span class="co">#&gt;   segment_length   lpercent</span></span>
<span><span class="co">#&gt; 1       88.91807 0.18367347</span></span>
<span><span class="co">#&gt; 2       39.51914 0.08163265</span></span>
<span><span class="co">#&gt; 3      108.67764 0.22448980</span></span>
<span><span class="co">#&gt; 4       19.75957 0.04081633</span></span>
<span><span class="co">#&gt; 5      138.31700 0.28571429</span></span>
<span><span class="co">#&gt; 6       49.39893 0.10204082</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov_route_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fcn_locate_feature_from_route.html">fcn_locate_feature_from_route</a></span><span class="op">(</span><span class="va">cov_route_table</span>, <span class="va">table_sf_2020</span><span class="op">)</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">441430</span>, <span class="fl">449400</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6928706</span>, <span class="fl">6936814</span><span class="op">)</span>, expand <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="va">ext</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">$</span><span class="va">xlim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">xlim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">ylim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">ylim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">cov_crop</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">cov</span>, <span class="va">ext</span><span class="op">)</span></span>
<span><span class="va">limits</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">cov_crop</span><span class="op">)</span></span>
<span><span class="va">rast_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cov_crop</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">coord_sf</span>, <span class="va">bbox</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"htele: covariate raster"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">limits</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">limits</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#guides(color = 'none')+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">transect_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cov_route_features</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">htele</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">coord_sf</span>, <span class="va">bbox</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"htele: extracted from transects"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">limits</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">limits</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rast_plot</span> <span class="op">+</span> <span class="va">transect_plot</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">'collect'</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="fig-htele_covariate-1.png" alt=""><p class="caption">plot of chunk htele_covariate</p>
</div>
</div>
<div class="section level3">
<h3 id="spatio-temporal-rasters">Spatio-temporal rasters<a class="anchor" aria-label="anchor" href="#spatio-temporal-rasters"></a>
</h3>
<p>Extraction of covariates from spatio-temporal raster files are also
supported. The algorithm first extracts spatio-temporal rasters as a
multi-layer SpatRaster in <code>terra</code> and creates the Event Route
Layer from all spatio-temporal layers.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov_sptemp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fcn_covariate_raster_load.html">fcn_covariate_raster_load</a></span><span class="op">(</span><span class="st">"hlwdy"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cov_sptemp</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "X199607" "X199707" "X199807" "X199907" "X200007" "X200107" "X200207"</span></span>
<span><span class="co">#&gt;  [8] "X200307" "X200407" "X200507" "X200607" "X200707" "X200807" "X200907"</span></span>
<span><span class="co">#&gt; [15] "X201007" "X201107" "X201207" "X201307" "X201407" "X201507" "X201607"</span></span>
<span><span class="co">#&gt; [22] "X201707" "X201807" "X201907"</span></span></code></pre></div>
<p>The covariates are extracted as a multi-layer “SpatRaster” (from the
<code>terra</code> package) where the names of the raster layers
represents the dates of the raster layer. Where only the year and month
of the raster layers are available, the dates of the raster layers are
assumed to be taken on the 15th of the month. The date of the month is
expected to have a relatively small effect on the covariate
extracted.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov_sptemp_route_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fcn_route_table_raster.html">fcn_route_table_raster</a></span><span class="op">(</span><span class="va">cov_sptemp</span>, <span class="va">table_sf_2020</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): external pointer is not valid</span></span></code></pre></div>
<p>The covariate value of the route event layer can be matched to the
date of the survey. The covariate value representative of the date which
the transect is surveyed can be interpolated by the following
methods:</p>
<ul>
<li><p>bilinear: bilinear interpolation between the two closest dates of
the survey date, weighted by how close the survey is to the two dates.
If the survey date is earlier or later than all of the dates of the
covariate layers, then the earliest or latest covariate layer is
selected respectively</p></li>
<li><p>nearest: the covariate layer closest to the survey date is
used</p></li>
<li><p>“lag1” / “lag2” / “lag3” (work in progress): lagged layers –
select the first, second or third layer available earlier than the
survey date. If the lagged layer is not available, then select the
earliest layer available.</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">route_table_date_matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fcn_covariate_match_date.html">fcn_covariate_match_date</a></span><span class="op">(</span><span class="va">cov_sptemp_route_table</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">cov_sptemp</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">'bilinear'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">route_table_date_matched</span><span class="op">)</span></span>
<span><span class="co">#&gt;           TransectID       Date  Tlength X199607 X199707 X199807 X199907</span></span>
<span><span class="co">#&gt; 1 1.0_0_SOL.20210810 2021-08-10 484.1095     161     164     166     166</span></span>
<span><span class="co">#&gt; 2 1.0_0_SOL.20210810 2021-08-10 484.1095     163     166     167     168</span></span>
<span><span class="co">#&gt; 3 1.0_0_SOL.20210810 2021-08-10 484.1095     159     160     162     164</span></span>
<span><span class="co">#&gt; 4 1.0_0_SOL.20210810 2021-08-10 484.1095     160     162     164     166</span></span>
<span><span class="co">#&gt; 5 1.0_0_SOL.20210810 2021-08-10 484.1095     163     167     168     170</span></span>
<span><span class="co">#&gt; 6 1.0_0_SOL.20210810 2021-08-10 484.1095     162     164     164     164</span></span>
<span><span class="co">#&gt;   X200007 X200107 X200207 X200307 X200407 X200507 X200607 X200707 X200807</span></span>
<span><span class="co">#&gt; 1     165     164     164     164     163     163     162     162     163</span></span>
<span><span class="co">#&gt; 2     168     169     171     172     169     165     161     158     158</span></span>
<span><span class="co">#&gt; 3     166     167     169     170     169     164     158     156     159</span></span>
<span><span class="co">#&gt; 4     167     168     169     169     167     163     158     155     157</span></span>
<span><span class="co">#&gt; 5     170     171     171     171     168     165     161     159     161</span></span>
<span><span class="co">#&gt; 6     164     165     165     165     164     160     156     153     154</span></span>
<span><span class="co">#&gt;   X200907 X201007 X201107 X201207 X201307 X201407 X201507 X201607 X201707</span></span>
<span><span class="co">#&gt; 1     166     170     172     172     171     168     164     161     161</span></span>
<span><span class="co">#&gt; 2     162     166     169     169     168     165     164     163     164</span></span>
<span><span class="co">#&gt; 3     167     173     176     174     169     164     161     161     163</span></span>
<span><span class="co">#&gt; 4     164     170     174     173     169     165     163     162     163</span></span>
<span><span class="co">#&gt; 5     165     171     174     174     170     166     163     162     163</span></span>
<span><span class="co">#&gt; 6     158     164     172     176     175     171     164     157     151</span></span>
<span><span class="co">#&gt;   X201807 X201907     FMEAS    TMEAS segment_length   lpercent value</span></span>
<span><span class="co">#&gt; 1     162     167  39.51914 128.4372       88.91807 0.18367347   167</span></span>
<span><span class="co">#&gt; 2     162     162 128.43721 167.9564       39.51914 0.08163265   162</span></span>
<span><span class="co">#&gt; 3     161     161 167.95635 276.6340      108.67764 0.22448980   161</span></span>
<span><span class="co">#&gt; 4     161     161 276.63400 296.3936       19.75957 0.04081633   161</span></span>
<span><span class="co">#&gt; 5     162     163 296.39357 434.7106      138.31700 0.28571429   163</span></span>
<span><span class="co">#&gt; 6     155     159 434.71056 484.1095       49.39893 0.10204082   159</span></span></code></pre></div>
<p>The date matching algorithm creates / overwrites the “value” column
in the route_table as an output. Here we preview the extracted,
interpolated value next to the most recent layer of the spatio-temporal
raster.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov_sptemp_date_matched</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fcn_locate_feature_from_route.html">fcn_locate_feature_from_route</a></span><span class="op">(</span><span class="va">route_table_date_matched</span>, <span class="va">table_sf_2020</span><span class="op">)</span></span>
<span><span class="va">ext</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">$</span><span class="va">xlim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">xlim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">ylim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">bbox</span><span class="op">$</span><span class="va">ylim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">cov_sptemp_crop</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">cov_sptemp</span>, <span class="va">ext</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in eval(expr, envir, enclos): external pointer is not valid</span></span>
<span><span class="va">limits</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">cov_sptemp_crop</span><span class="op">)</span></span>
<span><span class="va">rast_sptemp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://dieghernan.github.io/tidyterra/reference/geom_spatraster.html" class="external-link">geom_spatraster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cov_sptemp_crop</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">X201907</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">coord_sf</span>, <span class="va">bbox</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"hlwdy: 2019/07 woody \nvegetation cover"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">limits</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">limits</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#guides(color = 'none')+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">transect_sptemp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cov_sptemp_date_matched</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">coord_sf</span>, <span class="va">bbox</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"hlwdy: transects (bilinear)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">limits</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">limits</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rast_sptemp_plot</span> <span class="op">+</span> <span class="va">transect_sptemp_plot</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">'collect'</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="fig-hlwdy_plot-1.png" alt=""><p class="caption">plot of chunk hlwdy_plot</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Frankie Cho, Jonathan Rhodes.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
