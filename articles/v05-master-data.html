<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SEQKoalaDataPipeline">
<title>5. Master data • SEQKoalaDataPipeline</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="5. Master data">
<meta property="og:description" content="SEQKoalaDataPipeline">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SEQKoalaDataPipeline</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/index.html">Introduction</a>
    <a class="dropdown-item" href="../articles/v01-setup.html">1. Setup</a>
    <a class="dropdown-item" href="../articles/v02-get-data.html">2. Get Data</a>
    <a class="dropdown-item" href="../articles/v03-linear-referencing.html">3. Linear Referencing</a>
    <a class="dropdown-item" href="../articles/v04-covariates.html">4. Covariate extraction</a>
    <a class="dropdown-item" href="../articles/v05-master-data.html">5. Master data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>5. Master data</h1>
            
      
      
      <div class="d-none name"><code>v05-master-data.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://seq-koala-monitoring.github.io/data-pipeline/">SEQKoalaDataPipeline</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="master-data">Master data<a class="anchor" aria-label="anchor" href="#master-data"></a>
</h2>
<p>Wrapper functions documented in the “Master data” section are
designed to abstract away the details of the smaller functions, such
that the most common use-cases of the package can be executed in
succinct code.</p>
<p>We begin by extracting all tables as simple features.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#data_dir &lt;- "M:\\Users\\uqfcho\\Documents\\seq-koala-monitoring\\working_data"</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="st">"C:\\Users\\uqfcho\\Documents/seq-koala-monitoring/working_data"</span></span>
<span><span class="fu"><a href="../reference/fcn_set_home_dir.html">fcn_set_home_dir</a></span><span class="op">(</span><span class="va">data_dir</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/fcn_set_grid_size.html">fcn_set_grid_size</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 2467, 1759, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 100, 100  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 378280, 554180, 6862464, 7109164  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : GDA2020 / MGA zone 56 (EPSG:7856) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; name        :  GridID </span></span>
<span><span class="co">#&gt; min value   :       1 </span></span>
<span><span class="co">#&gt; max value   : 2311397</span></span>
<span><span class="va">master</span> <span class="op">&lt;-</span> <span class="fu">fcn_all_tables_sf</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in fcn_keep_distinct(transect_sf): 24 records cannot be uniquely identified with</span></span>
<span><span class="co">#&gt; SiteNumber-TransectNumber-SurveyNumber. Keeping only distinct records.</span></span>
<span><span class="co">#&gt; Warning in fcn_line_transect_sf_1996(): Line Transect: attribute join incomplete. </span></span>
<span><span class="co">#&gt; Joined uniquely: 376. </span></span>
<span><span class="co">#&gt; Joined at the site level: 169. </span></span>
<span><span class="co">#&gt; Join failed: 0</span></span>
<span><span class="co">#&gt; Warning in fcn_keep_distinct(transect_sf, cols = c("SiteNumber", "TransectNumber", : 83 records cannot be</span></span>
<span><span class="co">#&gt; uniquely identified with SiteNumber-TransectNumber-SurveyNumber. Keeping only distinct records.</span></span>
<span><span class="co">#&gt; Warning in fcn_strip_transect_sf_all(): Strip Transect: attribute join incomplete. </span></span>
<span><span class="co">#&gt; Joined uniquely: 916. </span></span>
<span><span class="co">#&gt; Joined at the site level: 1726. </span></span>
<span><span class="co">#&gt; Join failed: 0</span></span></code></pre></div>
<p>The extracted “master” dataframe contains spatial representations of
the transects in both linestring formats (single observer line transects
from the newer 2020-current database) as well as other spatial
representations (strip/ UAoA transects, and some line transects from
1996-2015). The <code>fcn_mixed_extract_raster</code> function handles
these mixed formats simultaneously. It wraps around functions that use
linear referencing approaches to extract grid information from rasters,
as well as raster extraction tools, with <code>exactextractr</code> that
uses C++ as a backend for quick extraction.</p>
<p>The function <code>fcn_all_transect_grid_fractions</code> abstracts
away from that. In one function call, the algorithm executes the
following:</p>
<ol style="list-style-type: decimal">
<li><p>Generate spatial grid</p></li>
<li><p>SQL queries to extract transect-level data</p></li>
<li><p>Joining with spatial features (if needed) or generate spatial
features by coordinates</p></li>
<li><p>Buffer spatial features (if needed)</p></li>
<li><p>Calculate grid weight fractions - iterating through all buffer
values by buffering each polygon and extracting its weights</p></li>
<li><p>Collating all results into a list format</p></li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transect_grid</span> <span class="op">&lt;-</span> <span class="fu">fcn_all_transect_grid_fractions</span><span class="op">(</span>buffer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in fcn_keep_distinct(transect_sf): 24 records cannot be uniquely identified with</span></span>
<span><span class="co">#&gt; SiteNumber-TransectNumber-SurveyNumber. Keeping only distinct records.</span></span>
<span><span class="co">#&gt; Warning in fcn_line_transect_sf_1996(): Line Transect: attribute join incomplete. </span></span>
<span><span class="co">#&gt; Joined uniquely: 376. </span></span>
<span><span class="co">#&gt; Joined at the site level: 169. </span></span>
<span><span class="co">#&gt; Join failed: 0</span></span>
<span><span class="co">#&gt; Warning in fcn_keep_distinct(transect_sf, cols = c("SiteNumber", "TransectNumber", : 83 records cannot be</span></span>
<span><span class="co">#&gt; uniquely identified with SiteNumber-TransectNumber-SurveyNumber. Keeping only distinct records.</span></span>
<span><span class="co">#&gt; Warning in fcn_strip_transect_sf_all(): Strip Transect: attribute join incomplete. </span></span>
<span><span class="co">#&gt; Joined uniquely: 916. </span></span>
<span><span class="co">#&gt; Joined at the site level: 1726. </span></span>
<span><span class="co">#&gt; Join failed: 0</span></span></code></pre></div>
<p>The end result is a list containing tables of line transects, strip
transect, and all of area transects. The tables are in long format, so
each row corresponds to one grid cell that has an overlap with the
transect. Each transect is identified uniquely by its TransectID.</p>
<p>Particularly the Line Transect, Strip Transect and UAoA tables
contain the “GridID” and “fraction” column that contains the Grid cell
that it overlaps with, and the “fraction” columns showing the fraction
which the transect overlaps with. Depending on the buffer, the
“fraction” is different; here we illustrate a no-buffer (0) and 2.5km
(2500) buffer, in the columns ‘fraction_0’ and ‘fraction_2500’
respectively.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">transect_grid</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 4</span></span>
<span><span class="co">#&gt;  $ line_transect :'data.frame':  7255924 obs. of  15 variables:</span></span>
<span><span class="co">#&gt;   ..$ db              : chr [1:7255924] "1" "1" "1" "1" ...</span></span>
<span><span class="co">#&gt;   ..$ TransectID      : chr [1:7255924] "109.1_1_SOL.20110901" "109.1_1_SOL.20110901" "109.1_1_SOL.20110901" "109.1_1_SOL.20110901" ...</span></span>
<span><span class="co">#&gt;   ..$ SiteID          : int [1:7255924] 109 109 109 109 109 109 109 109 109 109 ...</span></span>
<span><span class="co">#&gt;   ..$ Date            : POSIXct[1:7255924], format: "2011-09-01" "2011-09-01" "2011-09-01" ...</span></span>
<span><span class="co">#&gt;   ..$ TrSiteID        : num [1:7255924] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ Tlength         : num [1:7255924] 278 278 278 278 278 275 275 275 275 275 ...</span></span>
<span><span class="co">#&gt;   ..$ Number_Sightings: int [1:7255924] 2 2 2 2 2 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ Number_Observers: num [1:7255924] 2 2 2 2 2 3 3 3 3 3 ...</span></span>
<span><span class="co">#&gt;   ..$ Start_Eastings  : num [1:7255924] 495982 495982 495982 495982 495982 ...</span></span>
<span><span class="co">#&gt;   ..$ Start_Northings : num [1:7255924] 6984954 6984954 6984954 6984954 6984954 ...</span></span>
<span><span class="co">#&gt;   ..$ End_Eastings    : num [1:7255924] 495707 495707 495707 495707 495707 ...</span></span>
<span><span class="co">#&gt;   ..$ End_Northings   : num [1:7255924] 6984989 6984989 6984989 6984989 6984989 ...</span></span>
<span><span class="co">#&gt;   ..$ GridID          : num [1:7255924] 903602 903601 902646 902645 902644 ...</span></span>
<span><span class="co">#&gt;   ..$ fraction_0      : num [1:7255924] 0.0204 0.2653 0.102 0.3469 0.2653 ...</span></span>
<span><span class="co">#&gt;   ..$ fraction_2500   : num [1:7255924] 0.000476 0.000476 0.000476 0.000476 0.000476 ...</span></span>
<span><span class="co">#&gt;  $ strip_transect:'data.frame':  8080793 obs. of  9 variables:</span></span>
<span><span class="co">#&gt;   ..$ TransectID      : chr [1:8080793] "1.1_3_ST.20101116" "1.1_3_ST.20101116" "1.1_3_ST.20101116" "1.1_3_ST.20101116" ...</span></span>
<span><span class="co">#&gt;   ..$ SiteID          : int [1:8080793] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ Date            : POSIXct[1:8080793], format: "2010-11-16" "2010-11-16" "2010-11-16" ...</span></span>
<span><span class="co">#&gt;   ..$ TArea           : num [1:8080793] 7.45 7.45 7.45 7.45 7.45 ...</span></span>
<span><span class="co">#&gt;   ..$ Number_Sightings: int [1:8080793] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">#&gt;   ..$ Number_Observers: num [1:8080793] 5 5 5 5 5 5 5 5 5 5 ...</span></span>
<span><span class="co">#&gt;   ..$ GridID          : num [1:8080793] 1439596 1439597 1439598 1439599 1439600 ...</span></span>
<span><span class="co">#&gt;   ..$ fraction_0      : num [1:8080793] 0.00753 0.07986 0.06464 0.04362 0.02261 ...</span></span>
<span><span class="co">#&gt;   ..$ fraction_2500   : num [1:8080793] 0.000383 0.000383 0.000383 0.000383 0.000383 ...</span></span>
<span><span class="co">#&gt;  $ uaoa          :'data.frame':  327602 obs. of  17 variables:</span></span>
<span><span class="co">#&gt;   ..$ SiteNumber      : int [1:327602] 216 216 216 216 216 216 216 216 216 216 ...</span></span>
<span><span class="co">#&gt;   ..$ Shape_Length    : num [1:327602] 5725 5725 5725 5725 5725 ...</span></span>
<span><span class="co">#&gt;   ..$ Shape_Area      : num [1:327602] 1137144 1137144 1137144 1137144 1137144 ...</span></span>
<span><span class="co">#&gt;   ..$ db              : chr [1:327602] "1996-2015" "1996-2015" "1996-2015" "1996-2015" ...</span></span>
<span><span class="co">#&gt;   ..$ TransectID      : chr [1:327602] "216.1_99_UAoA.20110417" "216.1_99_UAoA.20110417" "216.1_99_UAoA.20110417" "216.1_99_UAoA.20110417" ...</span></span>
<span><span class="co">#&gt;   ..$ SiteID          : int [1:327602] 216 216 216 216 216 216 216 216 216 216 ...</span></span>
<span><span class="co">#&gt;   ..$ Date            : POSIXct[1:327602], format: "2011-04-17" "2011-04-17" "2011-04-17" ...</span></span>
<span><span class="co">#&gt;   ..$ TArea           : num [1:327602] 114 114 114 114 114 ...</span></span>
<span><span class="co">#&gt;   ..$ Number_Sightings: int [1:327602] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ Number_Observers: num [1:327602] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;   ..$ TransectNumber  : int [1:327602] 99 99 99 99 99 99 99 99 99 99 ...</span></span>
<span><span class="co">#&gt;   ..$ SurveyNumber    : int [1:327602] 21 21 21 21 21 21 21 21 21 21 ...</span></span>
<span><span class="co">#&gt;   ..$ SubSurveyNumber : int [1:327602] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ TrSiteID        : num [1:327602] NA NA NA NA NA NA NA NA NA NA ...</span></span>
<span><span class="co">#&gt;   ..$ GridID          : num [1:327602] 1372965 1372966 1372967 1372968 1372969 ...</span></span>
<span><span class="co">#&gt;   ..$ fraction_0      : num [1:327602] 0.005845 0.005186 0.003696 0.002284 0.000751 ...</span></span>
<span><span class="co">#&gt;   ..$ fraction_2500   : num [1:327602] 0.000305 0.000305 0.000305 0.000305 0.000305 ...</span></span>
<span><span class="co">#&gt;  $ perp_distance :'data.frame':  2642 obs. of  12 variables:</span></span>
<span><span class="co">#&gt;   ..$ db              : chr [1:2642] "1996-2015" "1996-2015" "1996-2015" "1996-2015" ...</span></span>
<span><span class="co">#&gt;   ..$ TransectID      : chr [1:2642] "1.1_1_ST.19960213" "1.1_1_ST.19960816" "1.1_1_ST.19970318" "1.1_1_ST.19970818" ...</span></span>
<span><span class="co">#&gt;   ..$ SiteID          : int [1:2642] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ Date            : POSIXct[1:2642], format: "1996-02-13" "1996-08-16" "1997-03-18" ...</span></span>
<span><span class="co">#&gt;   ..$ TArea           : num [1:2642] 6.74 4.77 2.38 2.38 3.18 ...</span></span>
<span><span class="co">#&gt;   ..$ Number_Sightings: int [1:2642] 2 1 0 2 2 2 4 0 1 0 ...</span></span>
<span><span class="co">#&gt;   ..$ Number_Observers: num [1:2642] 6 7 4 4 5 6 4 5 5 4 ...</span></span>
<span><span class="co">#&gt;   ..$ SiteNumber      : int [1:2642] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ TransectNumber  : int [1:2642] 1 1 1 1 1 10 10 10 10 10 ...</span></span>
<span><span class="co">#&gt;   ..$ SurveyNumber    : int [1:2642] 1 2 3 4 7 7 15 18 20 22 ...</span></span>
<span><span class="co">#&gt;   ..$ SubSurveyNumber : int [1:2642] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;   ..$ TrSiteID        : num [1:2642] NA NA NA NA NA NA NA NA NA NA ...</span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Frankie Cho, Jonathan Rhodes.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
